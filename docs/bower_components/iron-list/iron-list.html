<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-scroll-target-behavior/iron-scroll-target-behavior.html"></head><body><dom-module id="iron-list"><template><style>:host{display:block;position:relative;}@media only screen and (-webkit-max-device-pixel-ratio: 1){:host{will-change:transform;}}#items{@apply (--iron-list-items-container);position:relative;}:host(:not([grid])) #items > ::content > *{width:100%;}#items > ::content > *{box-sizing:border-box;margin:0;position:absolute;top:0;will-change:transform;}</style><array-selector id="selector" items="{{items}}" selected="{{selectedItems}}" selected-item="{{selectedItem}}"></array-selector><div id="items"><content></content></div></template></dom-module><script>(function(){var a=navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/),b=a&&8<=a[1],c=3,d='-10000px',j=-100;Polymer({is:'iron-list',properties:{items:{type:Array},maxPhysicalCount:{type:Number,value:500},as:{type:String,value:'item'},indexAs:{type:String,value:'index'},selectedAs:{type:String,value:'selected'},grid:{type:Boolean,value:!1,reflectToAttribute:!0},selectionEnabled:{type:Boolean,value:!1},selectedItem:{type:Object,notify:!0},selectedItems:{type:Object,notify:!0},multiSelection:{type:Boolean,value:!1}},observers:['_itemsChanged(items.*)','_selectionEnabledChanged(selectionEnabled)','_multiSelectionChanged(multiSelection)','_setOverflow(scrollTarget)'],behaviors:[Polymer.Templatizer,Polymer.IronResizableBehavior,Polymer.IronA11yKeysBehavior,Polymer.IronScrollTargetBehavior],keyBindings:{up:'_didMoveUp',down:'_didMoveDown',enter:'_didEnter'},_ratio:0.5,_scrollerPaddingTop:0,_scrollPosition:0,_physicalSize:0,_physicalAverage:0,_physicalAverageCount:0,_physicalTop:0,_virtualCount:0,_physicalIndexForKey:null,_estScrollHeight:0,_scrollHeight:0,_viewportHeight:0,_viewportWidth:0,_physicalItems:null,_physicalSizes:null,_firstVisibleIndexVal:null,_lastVisibleIndexVal:null,_collection:null,_maxPages:2,_focusedItem:null,_focusedIndex:-1,_offscreenFocusedItem:null,_focusBackfillItem:null,_itemsPerRow:1,_itemWidth:0,_rowHeight:0,_templateCost:0,get _physicalBottom(){return this._physicalTop+this._physicalSize},get _scrollBottom(){return this._scrollPosition+this._viewportHeight},get _virtualEnd(){return this._virtualStart+this._physicalCount-1},get _hiddenContentSize(){var k=this.grid?this._physicalRows*this._rowHeight:this._physicalSize;return k-this._viewportHeight},get _maxScrollTop(){return this._estScrollHeight-this._viewportHeight+this._scrollerPaddingTop},_minVirtualStart:0,get _maxVirtualStart(){return Math.max(0,this._virtualCount-this._physicalCount)},_virtualStartVal:0,set _virtualStart(k){this._virtualStartVal=Math.min(this._maxVirtualStart,Math.max(this._minVirtualStart,k))},get _virtualStart(){return this._virtualStartVal||0},_physicalStartVal:0,set _physicalStart(k){this._physicalStartVal=k%this._physicalCount,0>this._physicalStartVal&&(this._physicalStartVal=this._physicalCount+this._physicalStartVal),this._physicalEnd=(this._physicalStart+this._physicalCount-1)%this._physicalCount},get _physicalStart(){return this._physicalStartVal||0},_physicalCountVal:0,set _physicalCount(k){this._physicalCountVal=k,this._physicalEnd=(this._physicalStart+this._physicalCount-1)%this._physicalCount},get _physicalCount(){return this._physicalCountVal},_physicalEnd:0,get _optPhysicalSize(){return this.grid?this._estRowsInView*this._rowHeight*this._maxPages:0===this._viewportHeight?Infinity:this._viewportHeight*this._maxPages},get _isVisible(){return!!(this.offsetWidth||this.offsetHeight)},get firstVisibleIndex(){if(null===this._firstVisibleIndexVal){var k=Math.floor(this._physicalTop+this._scrollerPaddingTop);this._firstVisibleIndexVal=this._iterateItems(function(l,m){return k+=this._getPhysicalSizeIncrement(l),k>this._scrollPosition?this.grid?m-m%this._itemsPerRow:m:this.grid&&this._virtualCount-1===m?m-m%this._itemsPerRow:void 0})||0}return this._firstVisibleIndexVal},get lastVisibleIndex(){if(null===this._lastVisibleIndexVal)if(this.grid){var k=this.firstVisibleIndex+this._estRowsInView*this._itemsPerRow-1;this._lastVisibleIndexVal=Math.min(this._virtualCount,k)}else{var l=this._physicalTop;this._iterateItems(function(m,n){if(l<this._scrollBottom)this._lastVisibleIndexVal=n;else return!0;l+=this._getPhysicalSizeIncrement(m)})}return this._lastVisibleIndexVal},get _defaultScrollTarget(){return this},get _virtualRowCount(){return Math.ceil(this._virtualCount/this._itemsPerRow)},get _estRowsInView(){return Math.ceil(this._viewportHeight/this._rowHeight)},get _physicalRows(){return Math.ceil(this._physicalCount/this._itemsPerRow)},ready:function(){this.addEventListener('focus',this._didFocus.bind(this),!0)},attached:function(){0===this._physicalCount&&this._debounceTemplate(this._render),this.listen(this,'iron-resize','_resizeHandler')},detached:function(){this.unlisten(this,'iron-resize','_resizeHandler')},_setOverflow:function(k){this.style.webkitOverflowScrolling=k===this?'touch':'',this.style.overflow=k===this?'auto':''},updateViewportBoundaries:function(){this._scrollerPaddingTop=this.scrollTarget===this?0:parseInt(window.getComputedStyle(this)['padding-top'],10),this._viewportWidth=this.$.items.offsetWidth,this._viewportHeight=this._scrollTargetHeight,this.grid&&this._updateGridMetrics()},_scrollHandler:function(){var k=Math.max(0,Math.min(this._maxScrollTop,this._scrollTop)),l=k-this._scrollPosition,m=0<=l;if(this._scrollPosition=k,this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,Math.abs(l)>this._physicalSize){var n=Math.round(l/this._physicalAverage)*this._itemsPerRow;this._physicalTop+=l,this._virtualStart+=n,this._physicalStart+=n,this._update()}else{var o=this._getReusables(m);m?(this._physicalTop=o.physicalTop,this._virtualStart+=o.indexes.length,this._physicalStart+=o.indexes.length):(this._virtualStart-=o.indexes.length,this._physicalStart-=o.indexes.length),0===o.indexes.length?this._increasePoolIfNeeded():this._update(o.indexes,m?null:o.indexes)}},_getReusables:function(k){var l,m,n,o,p=[],q=this._hiddenContentSize*this._ratio,r=this._virtualStart,s=this._virtualEnd,t=this._physicalCount,u=this._physicalTop+this._scrollerPaddingTop,v=this._scrollTop,w=this._scrollBottom;for(k?(l=this._physicalStart,m=this._physicalEnd,n=v-u):(l=this._physicalEnd,m=this._physicalStart,n=this._physicalBottom-w);o=this._getPhysicalSizeIncrement(l),n-=o,!(p.length>=t||n<=q);)if(k){if(s+p.length+1>=this._virtualCount)break;if(u+o>=v)break;p.push(l),u+=o,l=(l+1)%t}else{if(0>=r-p.length)break;if(u+this._physicalSize-o<=w)break;p.push(l),u-=o,l=0===l?t-1:l-1}return{indexes:p,physicalTop:u-this._scrollerPaddingTop}},_update:function(k,l){if(!(k&&0===k.length)){if(this._manageFocus(),this._assignModels(k),this._updateMetrics(k),l)for(;l.length;){var m=l.pop();this._physicalTop-=this._getPhysicalSizeIncrement(m)}this._positionItems(),this._updateScrollerSize(),this._increasePoolIfNeeded()}},_createPool:function(k){var l=Array(k);this._ensureTemplatized();for(var n,m=0;m<k;m++)n=this.stamp(null),l[m]=n.root.querySelector('*'),Polymer.dom(this).appendChild(n.root);return l},_increasePoolIfNeeded:function(){var k=this,l=this._physicalBottom>=this._scrollBottom&&this._physicalTop<=this._scrollPosition;if(this._physicalSize>=this._optPhysicalSize&&l)return!1;var m=Math.round(0.5*this._physicalCount);return l?(this._yield(function(){k._increasePool(Math.min(m,Math.max(1,Math.round(50/k._templateCost))))}),!0):(this._debounceTemplate(this._increasePool.bind(this,m)),!0)},_yield:function(k){var l=window,m=l.requestIdleCallback?l.requestIdleCallback(k):l.setTimeout(k,16);Polymer.dom.addDebouncer({complete:function(){l.cancelIdleCallback?l.cancelIdleCallback(m):l.clearTimeout(m),k()}})},_increasePool:function(k){var l=Math.min(this._physicalCount+k,this._virtualCount-this._virtualStart,Math.max(this.maxPhysicalCount,c)),m=this._physicalCount,n=l-m,o=window.performance.now();0>=n||([].push.apply(this._physicalItems,this._createPool(n)),[].push.apply(this._physicalSizes,Array(n)),this._physicalCount=m+n,this._physicalStart>this._physicalEnd&&this._isIndexRendered(this._focusedIndex)&&this._getPhysicalIndex(this._focusedIndex)<this._physicalEnd&&(this._physicalStart+=n),this._update(),this._templateCost=(window.performance.now()-o)/n)},_render:function(){if(this.isAttached&&this._isVisible)if(0===this._physicalCount)this.updateViewportBoundaries(),this._increasePool(c);else{var k=this._getReusables(!0);this._physicalTop=k.physicalTop,this._virtualStart+=k.indexes.length,this._physicalStart+=k.indexes.length,this._update(k.indexes),this._update()}},_ensureTemplatized:function(){if(!this.ctor){var k={};k.__key__=!0,k[this.as]=!0,k[this.indexAs]=!0,k[this.selectedAs]=!0,k.tabIndex=!0,this._instanceProps=k,this._userTemplate=Polymer.dom(this).querySelector('template'),this._userTemplate?this.templatize(this._userTemplate):console.warn('iron-list requires a template to be provided in light-dom')}},_getStampedChildren:function(){return this._physicalItems},_forwardInstancePath:function(k,l,m){0===l.indexOf(this.as+'.')&&this.notifyPath('items.'+k.__key__+'.'+l.slice(this.as.length+1),m)},_forwardParentProp:function(k,l){this._physicalItems&&this._physicalItems.forEach(function(m){m._templateInstance[k]=l},this)},_forwardParentPath:function(k,l){this._physicalItems&&this._physicalItems.forEach(function(m){m._templateInstance.notifyPath(k,l,!0)},this)},_forwardItemPath:function(k,l){if(this._physicalIndexForKey){var m=k.indexOf('.'),n=k.substring(0,0>m?k.length:m),o=this._physicalIndexForKey[n],p=this._offscreenFocusedItem,q=p&&p._templateInstance.__key__===n?p:this._physicalItems[o];if(q&&q._templateInstance.__key__===n)if(0<=m)k=this.as+'.'+k.substring(m+1),q._templateInstance.notifyPath(k,l,!0);else{var r=q._templateInstance[this.as];if(Array.isArray(this.selectedItems)){for(var s=0;s<this.selectedItems.length;s++)if(this.selectedItems[s]===r){this.set('selectedItems.'+s,l);break}}else this.selectedItem===r&&this.set('selectedItem',l);q._templateInstance[this.as]=l}}},_itemsChanged:function(k){'items'===k.path?(this._virtualStart=0,this._physicalTop=0,this._virtualCount=this.items?this.items.length:0,this._collection=this.items?Polymer.Collection.get(this.items):null,this._physicalIndexForKey={},this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,this._physicalCount=this._physicalCount||0,this._physicalItems=this._physicalItems||[],this._physicalSizes=this._physicalSizes||[],this._physicalStart=0,this._scrollTop>this._scrollerPaddingTop&&this._resetScrollPosition(0),this._removeFocusedItem(),this._debounceTemplate(this._render)):'items.splices'===k.path?(this._adjustVirtualIndex(k.value.indexSplices),this._virtualCount=this.items?this.items.length:0,this._debounceTemplate(this._render)):this._forwardItemPath(k.path.split('.').slice(1).join('.'),k.value)},_adjustVirtualIndex:function(k){k.forEach(function(l){if(l.removed.forEach(this._removeItem,this),l.index<this._virtualStart){var m=Math.max(l.addedCount-l.removed.length,l.index-this._virtualStart);this._virtualStart+=m,0<=this._focusedIndex&&(this._focusedIndex+=m)}},this)},_removeItem:function(k){this.$.selector.deselect(k),this._focusedItem&&this._focusedItem._templateInstance[this.as]===k&&this._removeFocusedItem()},_iterateItems:function(k,l){var m,n,o,p;if(2===arguments.length&&l){for(p=0;p<l.length;p++)if(m=l[p],n=this._computeVidx(m),null!=(o=k.call(this,m,n)))return o;}else{for(m=this._physicalStart,n=this._virtualStart;m<this._physicalCount;m++,n++)if(null!=(o=k.call(this,m,n)))return o;for(m=0;m<this._physicalStart;m++,n++)if(null!=(o=k.call(this,m,n)))return o}},_computeVidx:function(k){return k>=this._physicalStart?this._virtualStart+(k-this._physicalStart):this._virtualStart+(this._physicalCount-this._physicalStart)+k},_assignModels:function(k){this._iterateItems(function(l,m){var n=this._physicalItems[l],o=n._templateInstance,p=this.items&&this.items[m];null==p?(o.__key__=null,n.setAttribute('hidden','')):(o[this.as]=p,o.__key__=this._collection.getKey(p),o[this.selectedAs]=this.$.selector.isSelected(p),o[this.indexAs]=m,o.tabIndex=this._focusedIndex===m?0:-1,this._physicalIndexForKey[o.__key__]=l,n.removeAttribute('hidden'))},k)},_updateMetrics:function(k){Polymer.dom.flush();var l=0,m=0,n=this._physicalAverageCount,o=this._physicalAverage;this._iterateItems(function(p){m+=this._physicalSizes[p]||0,this._physicalSizes[p]=this._physicalItems[p].offsetHeight,l+=this._physicalSizes[p],this._physicalAverageCount+=this._physicalSizes[p]?1:0},k),this.grid?(this._updateGridMetrics(),this._physicalSize=Math.ceil(this._physicalCount/this._itemsPerRow)*this._rowHeight):this._physicalSize=this._physicalSize+l-m,this._physicalAverageCount!==n&&(this._physicalAverage=Math.round((o*n+l)/this._physicalAverageCount))},_updateGridMetrics:function(){this._itemWidth=0<this._physicalCount?this._physicalItems[0].getBoundingClientRect().width:200,this._rowHeight=0<this._physicalCount?this._physicalItems[0].offsetHeight:200,this._itemsPerRow=this._itemWidth?Math.floor(this._viewportWidth/this._itemWidth):this._itemsPerRow},_positionItems:function(){this._adjustScrollPosition();var k=this._physicalTop;if(this.grid){var l=this._itemsPerRow*this._itemWidth,m=(this._viewportWidth-l)/2;this._iterateItems(function(n,o){var p=o%this._itemsPerRow,q=Math.floor(p*this._itemWidth+m);this.translate3d(q+'px',k+'px',0,this._physicalItems[n]),this._shouldRenderNextRow(o)&&(k+=this._rowHeight)})}else this._iterateItems(function(n){this.translate3d(0,k+'px',0,this._physicalItems[n]),k+=this._physicalSizes[n]})},_getPhysicalSizeIncrement:function(k){return this.grid?this._computeVidx(k)%this._itemsPerRow==this._itemsPerRow-1?this._rowHeight:0:this._physicalSizes[k]},_shouldRenderNextRow:function(k){return k%this._itemsPerRow==this._itemsPerRow-1},_adjustScrollPosition:function(){var k=0===this._virtualStart?this._physicalTop:Math.min(this._scrollPosition+this._physicalTop,0);k&&(this._physicalTop-=k,!b&&0!==this._physicalTop&&this._resetScrollPosition(this._scrollTop-k))},_resetScrollPosition:function(k){this.scrollTarget&&(this._scrollTop=k,this._scrollPosition=this._scrollTop)},_updateScrollerSize:function(k){this._estScrollHeight=this.grid?this._virtualRowCount*this._rowHeight:this._physicalBottom+Math.max(this._virtualCount-this._physicalCount-this._virtualStart,0)*this._physicalAverage,k=k||0===this._scrollHeight,k=k||this._scrollPosition>=this._estScrollHeight-this._physicalSize,k=k||this.grid&&this.$.items.style.height<this._estScrollHeight,(k||Math.abs(this._estScrollHeight-this._scrollHeight)>=this._optPhysicalSize)&&(this.$.items.style.height=this._estScrollHeight+'px',this._scrollHeight=this._estScrollHeight)},scrollToItem:function(k){return this.scrollToIndex(this.items.indexOf(k))},scrollToIndex:function(k){if(!('number'!=typeof k||0>k||k>this.items.length-1)&&(Polymer.dom.flush(),0!==this._physicalCount)){k=Math.min(Math.max(k,0),this._virtualCount-1),(!this._isIndexRendered(k)||k>=this._maxVirtualStart)&&(this._virtualStart=this.grid?k-2*this._itemsPerRow:k-1),this._manageFocus(),this._assignModels(),this._updateMetrics(),this._physicalTop=Math.floor(this._virtualStart/this._itemsPerRow)*this._physicalAverage;for(var l=this._physicalStart,m=this._virtualStart,n=0,o=this._hiddenContentSize;m<k&&n<=o;)n+=this._getPhysicalSizeIncrement(l),l=(l+1)%this._physicalCount,m++;this._updateScrollerSize(!0),this._positionItems(),this._resetScrollPosition(this._physicalTop+this._scrollerPaddingTop+n),this._increasePoolIfNeeded(),this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null}},_resetAverage:function(){this._physicalAverage=0,this._physicalAverageCount=0},_resizeHandler:function(){this._debounceTemplate(function(){var k=Math.abs(this._viewportHeight-this._scrollTargetHeight);this.updateViewportBoundaries();('ontouchstart'in window||0<navigator.maxTouchPoints)&&0<k&&100>k||(this._isVisible?(this.toggleScrollListener(!0),this._resetAverage(),this._render()):this.toggleScrollListener(!1))}.bind(this))},_getModelFromItem:function(k){var l=this._collection.getKey(k),m=this._physicalIndexForKey[l];return null==m?null:this._physicalItems[m]._templateInstance},_getNormalizedItem:function(k){if(this._collection.getKey(k)===void 0){if('number'==typeof k){if(k=this.items[k],!k)throw new RangeError('<item> not found');return k}throw new TypeError('<item> should be a valid item')}return k},selectItem:function(k){k=this._getNormalizedItem(k);var l=this._getModelFromItem(k);!this.multiSelection&&this.selectedItem&&this.deselectItem(this.selectedItem),l&&(l[this.selectedAs]=!0),this.$.selector.select(k),this.updateSizeForItem(k)},deselectItem:function(k){k=this._getNormalizedItem(k);var l=this._getModelFromItem(k);l&&(l[this.selectedAs]=!1),this.$.selector.deselect(k),this.updateSizeForItem(k)},toggleSelectionForItem:function(k){k=this._getNormalizedItem(k),this.$.selector.isSelected(k)?this.deselectItem(k):this.selectItem(k)},clearSelection:function(){function k(l){var m=this._getModelFromItem(l);m&&(m[this.selectedAs]=!1)}Array.isArray(this.selectedItems)?this.selectedItems.forEach(k,this):this.selectedItem&&k.call(this,this.selectedItem),this.$.selector.clearSelection()},_selectionEnabledChanged:function(k){var l=k?this.listen:this.unlisten;l.call(this,this,'tap','_selectionHandler')},_selectionHandler:function(k){var l=this.modelForElement(k.target);if(l){var m,n,o=Polymer.dom(k).path[0],p=Polymer.dom(this.domHost?this.domHost.root:document).activeElement,q=this._physicalItems[this._getPhysicalIndex(l[this.indexAs])];'input'!==o.localName&&'button'!==o.localName&&'select'!==o.localName&&(m=l.tabIndex,l.tabIndex=j,n=p?p.tabIndex:-1,l.tabIndex=m,p&&q!==p&&q.contains(p)&&n!==j||this.toggleSelectionForItem(l[this.as]))}},_multiSelectionChanged:function(k){this.clearSelection(),this.$.selector.multi=k},updateSizeForItem:function(k){k=this._getNormalizedItem(k);var l=this._collection.getKey(k),m=this._physicalIndexForKey[l];null!=m&&(this._updateMetrics([m]),this._positionItems())},_manageFocus:function(){var k=this._focusedIndex;0<=k&&k<this._virtualCount?this._isIndexRendered(k)?this._restoreFocusedItem():this._createFocusBackfillItem():0<this._virtualCount&&0<this._physicalCount&&(this._focusedIndex=this._virtualStart,this._focusedItem=this._physicalItems[this._physicalStart])},_isIndexRendered:function(k){return k>=this._virtualStart&&k<=this._virtualEnd},_isIndexVisible:function(k){return k>=this.firstVisibleIndex&&k<=this.lastVisibleIndex},_getPhysicalIndex:function(k){return this._physicalIndexForKey[this._collection.getKey(this._getNormalizedItem(k))]},_focusPhysicalItem:function(k){if(!(0>k||k>=this._virtualCount)){this._restoreFocusedItem(),this._isIndexRendered(k)||this.scrollToIndex(k);var n,l=this._physicalItems[this._getPhysicalIndex(k)],m=l._templateInstance;m.tabIndex=j,l.tabIndex===j&&(n=l),n||(n=Polymer.dom(l).querySelector('[tabindex="'+j+'"]')),m.tabIndex=0,this._focusedIndex=k,n&&n.focus()}},_removeFocusedItem:function(){this._offscreenFocusedItem&&Polymer.dom(this).removeChild(this._offscreenFocusedItem),this._offscreenFocusedItem=null,this._focusBackfillItem=null,this._focusedItem=null,this._focusedIndex=-1},_createFocusBackfillItem:function(){var k=this._focusedIndex,l=this._getPhysicalIndex(k);if(!(this._offscreenFocusedItem||null==l||0>k)){if(!this._focusBackfillItem){var m=this.stamp(null);this._focusBackfillItem=m.root.querySelector('*'),Polymer.dom(this).appendChild(m.root)}this._offscreenFocusedItem=this._physicalItems[l],this._offscreenFocusedItem._templateInstance.tabIndex=0,this._physicalItems[l]=this._focusBackfillItem,this.translate3d(0,d,0,this._offscreenFocusedItem)}},_restoreFocusedItem:function(){var k,l=this._focusedIndex;!this._offscreenFocusedItem||0>this._focusedIndex||(this._assignModels(),k=this._getPhysicalIndex(l),null!=k&&(this._focusBackfillItem=this._physicalItems[k],this._focusBackfillItem._templateInstance.tabIndex=-1,this._physicalItems[k]=this._offscreenFocusedItem,this._offscreenFocusedItem=null,this.translate3d(0,d,0,this._focusBackfillItem)))},_didFocus:function(k){var l=this.modelForElement(k.target),m=this._focusedItem?this._focusedItem._templateInstance:null,n=null!==this._offscreenFocusedItem,o=this._focusedIndex;l&&m&&(m===l?!this._isIndexVisible(o)&&this.scrollToIndex(o):(this._restoreFocusedItem(),m.tabIndex=-1,l.tabIndex=0,o=l[this.indexAs],this._focusedIndex=o,this._focusedItem=this._physicalItems[this._getPhysicalIndex(o)],n&&!this._offscreenFocusedItem&&this._update()))},_didMoveUp:function(){this._focusPhysicalItem(this._focusedIndex-1)},_didMoveDown:function(k){k.detail.keyboardEvent.preventDefault(),this._focusPhysicalItem(this._focusedIndex+1)},_didEnter:function(k){this._focusPhysicalItem(this._focusedIndex),this._selectionHandler(k.detail.keyboardEvent)}})})();</script></body></html>