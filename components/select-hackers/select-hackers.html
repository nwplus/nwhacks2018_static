<link rel="import" href="/bower_components/polymerfire/firebase-app.html">
<link rel="import" href="/bower_components/polymerfire/firebase-document.html">
<link rel="import" href="/bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="/bower_components/polymerfire/firebase-query.html">
<link rel="import" href="/bower_components/iron-list/iron-list.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">

<dom-module id="select-hackers">
  <template>
    <style>
      iron-list {
        margin: 20px -15px 0;
        height: 1000px;
        overflow-x: hidden;
      }
      paper-input {
        display: inline-block;
      }
      paper-card {
        color: black;
        max-width: 900px;
        margin: 0px auto 5px;
        display: block;
      }
      table {
        text-align: left;
        width: 100%;
        table-layout: fixed;
      }
      a {
        color: green;
      }
      .tag {
        color: green;
        font-weight: bold;
        display: inline-block;
        padding: 5px;
        margin: 5px;
        border: 2px solid green;
      }
      .tag.bad {
        color: red;
        border-color: red;
      }
      .tag.warn {
        color: orange;
        border-color: orange;
      }
      .right {
        float: right;
      }
      .card-actions paper-checkbox {
        margin-left: 8px;
      }
      a {
        cursor: pointer;
      }
      [label="Status"] {
        width: 100px;
      }
      [label="Response"] {
        width: 170px;
      }
      #filters paper-input, #filters paper-dropdown-menu {
        margin-top: -15px;
      }
    </style>
    <div class="content">
      <paper-card id="filters">
        <div class="card-content">
          Filters &nbsp;
          <minimizable-box>
            <paper-dropdown-menu label="Status" selected-item-label="{{filters.status}}">
              <paper-listbox class="dropdown-content" selected="[[selected(hacker.status)]]">
                <paper-item>All</paper-item>
                <template is="dom-repeat" items="[[categories]]">
                  <paper-item>[[item]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
            &nbsp;
            <paper-dropdown-menu label="Response" selected-item-label="{{filters.response}}">
              <paper-listbox class="dropdown-content" selected="[[responded(hacker.response)]]">
                <paper-item>All</paper-item>
                <template is="dom-repeat" items="[[responseCategories]]">
                  <paper-item>[[item]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
            &nbsp;
            <paper-input label="Search" value="{{filters.search}}"></paper-input>

            Showing
            <span>{{filteredCount}}</span>
            of
            <span>{{totalCount}}</span>

            <br>
            <paper-checkbox checked="{{filters.mentor}}">Wants to Mentor</paper-checkbox> &nbsp;
            <paper-checkbox checked="{{filters.first}}">First Time</paper-checkbox> &nbsp;
            <paper-checkbox checked="{{filters.reimbursement}}">Needs Reimbursement</paper-checkbox> &nbsp;
            <paper-checkbox checked="{{filters.checked_in}}">Checked In</paper-checkbox> &nbsp;
            <a on-tap="export">Export to CSV</a>
          </minimizable-box>
        </div>
      </paper-card>
    </div>
    <!-- <template is="dom-repeat" items="{{hackers}}" as="hacker" filter="{{filter(status)}}" observe="status"> -->
    <iron-list id="list" items="[[filter(hackers, filters, incr)]]" as="hacker">
      <template>
        <div>
          <paper-card heading="[[title(hacker)]]">
            <div class="card-content">
              <table>
                <thead>
                  <th> School </th>
                  <th>City</th>
                  <th>GitHub</th>
                  <th>LinkedIn</th>
                  <th>Personal Site</th>
                  <th>Resume</th>
                  <th>T-Shirt Size</th>
                </thead>
                <tbody>
                  <tr>
                    <td>[[hacker.school]]</td>
                    <td>[[hacker.city]]</td>
                    <td>
                      <template is="dom-if" if="[[hacker.github]]">
                        <a target="_blank" href="[[githubLink(hacker.github)]]">[[hacker.github]]</a>
                      </template>
                    </td>
                    <td>
                      <template is="dom-if" if="[[hacker.linkedin]]">
                        <a target="_blank" href="[[linkedinLink(hacker.linkedin)]]">[[hacker.linkedin]]</a>
                      </template>
                    </td>
                    <td>
                      <template is="dom-if" if="[[hacker.personalsite]]">
                        <a target="_blank" href="[[hacker.personalsite]]">[[hacker.personalsite]]</a>
                      </template>
                    </td>
                    <td>
                      <template is="dom-if" if="[[hacker.resume]]">
                        <a target="_blank" href="[[resumeLink(hacker.resume)]]">Resume</a>
                      </template>
                    </td>
                    <td>[[hacker.tshirt]]</td>
                  </tr>
                </tbody>
              </table>
              <h3>Why do you want to come to nwHacks?</h3>
              <p>[[hacker.reason]]</p>

              <template is="dom-if" if="[[hacker.travel_reimbursement]]">
                <div class="tag">Travel Reimbursement</div>
              </template>
              <template is="dom-if" if="[[hacker.first_hackathon]]">
                <div class="tag">First Hackathon</div>
              </template>
              <template is="dom-if" if="[[hacker.mentor]]">
                <div class="tag">Wants to Mentor</div>
              </template>
              <template is="dom-if" if="[[hacker.duplicate]]">
                <div class="tag bad">Multiple Submissions</div>
              </template>

              <template is="dom-if" if="[[respondedWith(hacker, 0)]]">
                <div class="tag bad">No Response</div>
              </template>
              <template is="dom-if" if="[[respondedWith(hacker, 1)]]">
                <div class="tag">Going</div>
              </template>
              <template is="dom-if" if="[[respondedWith(hacker, 2)]]">
                <div class="tag bad">Not Going</div>
              </template>
              <template is="dom-if" if="[[respondedWith(hacker, 3)]]">
                <div class="tag warn">Need Reimbursement</div>
              </template>

              <template is="dom-if" if="[[hacker.hs]]">
                <div class="tag bad">Minor</div>
              </template>

              <br>
              <paper-input label="Phone Number" type="tel" on-change="phoneChange" value="{{hacker.phone}}"></paper-input>
              </table>
            </div>
            <div class="card-actions">
              <select selected="{{selected(hacker.status)}}" on-change="onSelect" disabled$="[[hacker.acceptance_sent]]">
                <template is="dom-repeat" items="[[categories]]">
                  <option selected$="[[eq(item, hacker.status)]]">[[item]]</option>
                </template>
              </select>
              <paper-checkbox checked="{{hacker.checked_in}}" on-change="checkIn">Checked In</paper-checkbox>
              <span class="right">
                #<span>[[hacker.id]]</span>
              </span>
            </div>
          </paper-card>
        </div>
      </template>
    </iron-list>

    <paper-dialog id="error" modal>
      <h2>Error</h2>
      <p>[[error]]</p>
      <p>Please try again later or use a different browser.</p>
      <div class="buttons">
        <paper-button dialog-confirm autofocus>close</paper-button>
      </div>
    </paper-dialog>

    <!--<iron-ajax auto url="/api/register/" handle-as="json" on-response="handleResponse" on-error="handleErr"></iron-ajax>-->

    <firebase-app auth-domain="nwhacks-96701.firebaseapp.com"
                  database-url="https://nwhacks-96701.firebaseio.com"
                  api-key="AIzaSyBou6z9QA7zvCpxUFLoTbwQZcWuBn47yEA">
    </firebase-app>
    <firebase-auth id="auth"
                   user="{{user}}"
                   provider="google"
                   on-error="handleError"
                   signed-in="{{signedIn}}"
                   status-known="{{statusKnown}}">
    </firebase-auth>

    <firebase-document path="/admins/[[user.uid]]" data="{{isAdmin}}">
    </firebase-document>

    <firebase-document id="regs" path="/registrations" data="{{registrations}}">
    </firebase-document>

  </template>
  <script src="/bower_components/lunr.js/lunr.min.js"></script>
  <script src="/bower_components/comma-separated-values/csv.min.js"></script>
  <script src="./select-hackers.js"></script>
</dom-module>
